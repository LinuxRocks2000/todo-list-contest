localStorage.todolist||(localStorage.todolist="{}");var completionFracMode=$("displayMode").checked;$("displayMode").onclick=()=>{completionFracMode=$("displayMode").checked,root.renderCompletion()};var confirmbeforedelete=$("confirmbeforedelete").checked;function formatCompletion(e){return completionFracMode?e[0]+"/"+e[1]:Math.round(e[0]/e[1]*100)+"%"}function needsATrim(e){var t=e.indexOf("\n");if(-1!=t&&t!=e.length-1)return!0}$("confirmbeforedelete").onclick=()=>{confirmbeforedelete=$("confirmbeforedelete").checked};class Task{constructor(e,t,n,s){this.weight=n,this.isComplete=s,this.parent=void 0,this.dataEl=$_("textarea",{class:"editor"},t),this.completionEl=$_("span",{class:"completionValue"}),this.subtasks=[];var i=$k($i($t($_("div",{class:"name"},e)),()=>{o.name.data=o.name.data.replace("\n","").trim(),""==o.name.data&&(o.name.data="Untitled Task"),$("content").innerHTML="",$("content").appendChild(o.dataEl),$show($("completion")),$("weight").value=o.weight,$("complete").checked=o.isComplete,$i($("complete"),()=>{editorOwner==this&&(o.isComplete=$("complete").checked,o.notifyChange())}),$e($("weight"),()=>{editorOwner==this&&(o.weight=$("weight").value-0,o.notifyChange())}),editorOwner&&editorOwner.element.classList.remove("active"),this.element.classList.add("active"),editorOwner=this}),()=>{o.dataEl.focus()});this.element=$_("div",{class:"task"},i,this.completionEl),$h(this.element,()=>{$show($("floatingbar"));var e=this.element.getBoundingClientRect();$("floatingbar").style.top=e.top+"px",$("floatingbar").style.left=e.right+"px",hoverOwner=this});var o=this;this.name=$e(i,()=>{o.notifyChange()}),this.data=$e(this.dataEl,()=>{o.notifyChange()}),this.stub=!0,this.renderCompletion()}complete(){if(!this.isComplete)return!1;for(var e=0;e<this.subtasks.length;e++)if(!this.subtasks[e].complete())return!1;return!0}completion(){var e=[0,this.weight];this.isComplete&&(e[0]+=this.weight);for(var t=0;t<this.subtasks.length;t++){var n=this.subtasks[t].completion();e[0]+=n[0],e[1]+=n[1]}return e}getContainer(){return this.element}renderCompletion(){var e=this.completion();this.element.style.setProperty("--completion",e[0]/e[1]*100+"%"),this.completionEl.innerText=formatCompletion(e),this.subtasks.forEach(e=>{e.renderCompletion()})}notifyChange(){this.parent&&this.parent.notifyChange()}acceptChild(e){if(this.stub){var t=$id($_("input",{type:"checkbox",class:"taskExpander"}));this.element.$a(t,$k($t($_("label",{class:"taskExpandButton",for:t.id})),function(){$(this.htmlFor).checked=!$(this.htmlFor).checked}))}this.stub=!1,this.subtasks.push(e),this.notifyChange()}attach(e){e.acceptChild(this),e.getContainer().$a(this.element),this.parent=e}isFocus(){return this.element==document.activeElement||this.element.matches(":hover")}pack(){var e={name:this.name.data,content:this.data.data,complete:this.isComplete,weight:this.weight,tasks:[]};return this.subtasks.forEach(t=>{e.tasks.push(t.pack())}),e}static unpack(e){var t=new Task(e.name,e.content,e.weight,e.complete);return e.tasks.forEach(e=>{Task.unpack(e).attach(t)}),t}findFocus(){for(var e=0;e<this.subtasks.length;e++){var t=this.subtasks[e].findFocus();if(t)return t}if(this.isFocus())return this}remove(e){for(var t=0;t<this.subtasks.length;t++)this.subtasks[t]==e&&(this.subtasks[t].removing(),this.subtasks.splice(t,1));this.notifyChange(),0==this.subtasks.length&&(this.stub=!0,$r($("input",this.element)),$r($("label",this.element)))}removing(){for(var e=0;e<this.subtasks.length;e++)this.subtasks[e].removing();$r(this.element),hoverOwner==this&&(hoverOwner=void 0,$hide($("floatingbar"))),$hide($("completion")),$r(this.dataEl)}}class Set{constructor(e,t){this.name=e,this.tasks=[],this.element=$_("div",{class:"set"}),this.onchange=t}static unpack(e){var t=new Set(e.name);return e.tasks.forEach(e=>{Task.unpack(e).attach(t)}),t}pack(){var e={name:this.name,tasks:[]};return this.tasks.forEach(t=>{e.tasks.push(t.pack())}),e}attach(e){$a(e,this.element),$t($h(this.element,()=>{$show($("floatingbar"));var e=this.element.getBoundingClientRect();$("floatingbar").style.top=e.top+"px",$("floatingbar").style.left=e.right+"px",hoverOwner=this}))}getContainer(){return this.element}acceptChild(e){this.tasks.push(e),this.notifyChange()}completion(){for(var e=[0,0],t=0;t<this.tasks.length;t++){var n=this.tasks[t].completion();e[0]+=n[0],e[1]+=n[1]}return e}notifyChange(){this.onchange&&this.onchange(),this.renderCompletion()}renderCompletion(){var e=this.completion();$("#nav > span").style.setProperty("--completion",e[0]/e[1]*100+"%"),$("globalCompletion").innerText=formatCompletion(e),this.tasks.forEach(e=>{e.renderCompletion()})}findFocus(){for(var e=0;e<this.tasks.length;e++){var t=this.tasks[e].findFocus();if(t)return t}}remove(e){for(var t=0;t<this.tasks.length;t++)this.tasks[t]==e&&(this.tasks[t].removing(),this.tasks.splice(t,1));this.notifyChange()}}var todolist=JSON.parse(localStorage.todolist),hoverOwner=void 0,editorOwner=void 0;function commit(){localStorage.todolist=JSON.stringify(todolist)}var root=void 0,currentSet=void 0;function openSet(e){root=Set.unpack(todolist[e]),currentSet=todolist[e],root.onchange=()=>{todolist[root.name]=root.pack(),commit()},$("navInside").innerHTML="",root.attach($("navInside")),$("setName").innerText=e}function addThing(e){void 0==e&&(e=hoverOwner),void 0==e&&(e=root),new Task("Untitled","",1,!1).attach(e)}function delThing(e){if(setSelectCurrent)(!confirmbeforedelete||confirm("Are you sure you want to delete the "+setSelectCurrent.name+" Set?"))&&(delete todolist[setSelectCurrent.name],commit(),$("navInside").innerHTML="",setSelectMenu=genSetSelectMenu(),$("content").innerHTML="",$("content").appendChild(setSelectMenu));else if(!confirmbeforedelete||confirm("Are you sure you want to delete this Task?")){if(void 0==e&&(e=hoverOwner),e==root)return;e.parent.remove(e)}}var setSelectCurrent=void 0;function genSetSelectMenu(){var e=$_("div",{class:"setSelect"});return Object.keys(todolist).forEach(t=>{var n=todolist[t];e.$a($h($t($E($i($_("div",{},t),()=>{openSet(n.name)}),e=>{needsATrim(e.$v())&&e.$v(e.$v().replace("\n","").trim()),delete todolist[n.name],todolist[e.$v()]=n,n.name=e.$v(),todolist[n.name]==currentSet&&openSet(n.name),commit()})),()=>{setSelectCurrent=n},()=>{setSelectCurrent=void 0}))}),e.$a($t($i($_("div",{},$_("img",{src:"res/add.svg"})),()=>{todolist["Untitled Set"]={name:"Untitled Set",tasks:[]},setSelectMenu=genSetSelectMenu(),$("content").innerHTML="",$("content").appendChild(setSelectMenu)}))),e}var setSelectMenu=genSetSelectMenu();function classism(e){for(var t=[],n=0;n<e.children.length;n++)t.push(e.children[n].value);e.onchange=()=>{t.forEach(t=>{document.body.classList.remove(e.id+"-"+t)}),document.body.classList.add(e.id+"-"+e.value)},e.onchange()}$("content").appendChild(setSelectMenu),$t($i($("#nav > span"),()=>{$("content").innerHTML="",$("content").appendChild(setSelectMenu)})),classism($("colors")),classism($("fonts")),classism($("paddings"));var settingsContext=$("settingsMenu");function settings(){$("content").innerHTML="",$("content").appendChild(settingsContext)}settingsContext.parentNode.removeChild(settingsContext),window.addEventListener("keyup",e=>{e.altKey&&e.shiftKey&&("X"==e.key&&($("content").innerHTML="",$("content").appendChild(setSelectMenu)),"D"==e.key&&delThing(),"N"==e.key&&addThing(),"R"==e.key&&(completionFracMode=!completionFracMode,$("displayMode").checked=completionFracMode,root.renderCompletion())),"Home"==e.key&&(root.element.$hover[0](),root.element.focus())});